# ファーム ソリューションの SharePoint アドイン モデルへの変換
ファーム ソリューションを SharePoint アドイン モデルに変換します。Web パーツ、ページ レイアウト、マスター ページ、タイマー ジョブなどを SharePoint アドイン モデルに変換する方法について説明します。

_**適用対象:** SharePoint 用アドイン | SharePoint 2013 | SharePoint Online_

SharePoint 環境がファーム ソリューションを使用して拡張済みである場合に、SharePoint Online に容易に切り替えられるように拡張機能を SharePoint アドイン モデルに移行するには、ファーム ソリューションを SharePoint アドイン モデルに変換する必要があります。ファーム ソリューションの SharePoint アドイン モデルへの変換には、既存の拡張機能の分析、新しい SharePoint 用アドインの設計と開発、および運用環境でのアドインのテストと展開が含まれます。この記事では、ファーム ソリューションを SharePoint アドイン モデルに変換するときに用いるプロセスとベスト プラクティスについて説明します。

## 変換プロセスの計画
<a name="sectionSection0"> </a>

ファーム ソリューションを SharePoint アドイン モデルに変換する場合は、ユーザーへの影響が最小限に抑えられていることを確認します。現在のファーム ソリューションを慎重に分析し、組織のニーズを満たすように新しい SharePoint 用アドインを設計します。変換が成功したことを、次のプロセスで確認するようにお勧めします。


1. 準備。 以下について調べます。
    
    - SharePoint アドイン モデル、さまざまな種類のアドイン、およびホストのオプション。 詳細については、「[SharePoint アドイン](https://msdn.microsoft.com/library/office/fp179930.aspx)」を参照してください。
    
    - オンプレミス データにアクセスするためのリモート アクセス テクノロジ。
    
2. ソリューションの評価。以下のようにして、機能要件とビジネス要件を分析します。 
    
    - 現在の環境に展開済みのファーム ソリューションを特定します。展開済みの拡張機能を特定するには、サード パーティ製ツールの使用を検討してください。特定した各ファーム ソリューションの詳細な分析を実行します。
    
    - ユーザーとともに要件を確認します。日常業務を実行する既存のファーム ソリューションの使い方をユーザーに示してもらうことを検討します。
    
    - 新しい SharePoint 用アドインに組み込む新機能を、特定、文書化、および設計します。その他のアイデアについて、ユーザーからの新機能要望リストを確認することを検討します。
    
    - 未使用の機能を特定し、その機能を新しい SharePoint 用アドインから省略することでユーザーと合意します。 
    
    - 各ファーム ソリューションについて、SharePoint 用アドインを追加するかどうかを決定します。 SharePoint 管理拡張機能などの一部のソリューションは、SharePoint アドイン モデルでは複製できません。 詳細については、「[SharePoint アドインと SharePoint ソリューションの比較](http://msdn.microsoft.com/library/0e9efadb-aaf2-4c0d-afd5-d6cf25c4e7a8.aspx)」および「[SharePoint アドインまたは SharePoint ソリューションの選択](http://msdn.microsoft.com/library/8459e265-b8fd-4bf8-911e-d63cae8bf96f.aspx)」を参照してください。
    
3.  ソリューションの計画。 以下に基づいて、SharePoint アドイン モデルを使用して新しいアプリケーションを設計します。
    
    - 手順 2 で収集した要件。
    
    - 既存コードの分析。コード分析の実行中に、削除可能なコード部分を特定することを検討します (コードが使用されなくなった、または要件が変更されたなど)。
    
4. SharePoint アドイン モデル バージョンのアプリケーションの開発とテスト。これは通常、変換プロセスにおいて最も時間のかかる手順です。 
    
5. 新しいアドインの展開。要件に応じて、新しい SharePoint 用アドインと並列でファーム ソリューションを稼働させ続けることにする場合もあれば、ファーム ソリューションを取り消して、新しい SharePoint 用アドインの使用のみをユーザーに許可する場合もあります。どちらのシナリオであっても、展開が安定していることを確認し、適切な通知事項をユーザーに送信します。既存のサイト コレクションのコンテンツがファーム ソリューションに依存していた場合には (たとえば、コンテンツ タイプを使用してコンテンツが作成されているなど)、ファーム ソリューションを完全に取り消す前に、新しい SharePoint 用アドイン モデル ソリューションを使用するように既存のコンテンツを変換する必要があります。この作業は時間がかかり、難しい場合もあるので、必ず十分な時間を確保してください。

## 新しい SharePoint アドインを展開するための変換方法
<a name="sectionSection1"> </a>

新しい SharePoint 用アドインの開発と単体テストが完了したら、次の表に記載されているいずれかの変換方法を使用して、新しい SharePoint 用アドインに対応するようにファーム ソリューションの変換を開始します。

|**変換方法**|**説明**|**メリット**|**デメリット**|
|:-----|:-----|:-----|:-----|
|インプレース|新しい SharePoint 用アドインを、既存の SharePoint 環境内に展開します。ファーム ソリューションを取り消す前に、新しい SharePoint 用アドインがサイトで使用されていることを確認する必要があります。|<ul><li>全体的なユーザーへの影響が抑えられます。</li><li>既存の SharePoint 環境を使用するため、必要なリソースは少なくて済みます。</li><li>サードパーティ製のツールは必要ありません。</li><li>サイトのダウンタイムは最小限に抑えられます。</li><li>ファーム全体を一度にアップグレードするのではなく、サイト コレクションを一度に 1 つずつアップグレードします。</li><li>URL は変更されません。</li></ul>|<ul><li>サイト上にある、影響を受けるすべての資産に対して、完了の進行状況を追跡することは困難です。</li><li>孤立ファイルが作成される可能性が高くなります。 ファイル システム上の存在しないファイルを、資産がポイントしている状態のことを、「孤立」といいます。</li></ul>|
|スウィングまたはコンテンツ移行|ファーム ソリューションが現在展開されている既存のサイト コレクションからコンテンツを抽出し、新しい SharePoint 用アドインを使用する新しいサイト コレクションにそのコンテンツを展開します。一般に、SharePoint Online にコンテンツを移行する場合には、このプロセスを使用します。|<ul><li>以前のファーム ソリューションの依存関係がない、クリーンな SharePoint 環境。</li><li>新しいサイト コレクションは運用環境から分離されます。 準備ができたときに、更新されたサイト コレクションをリリースします。</ul>|<ul><li>コンテンツ移行にはサード パーティ製のツールによる支援が必要になります。</li><li>追加の SharePoint 環境が必要です。</li><li>サイトのダウンタイムが必要です。</li><li>並列で実行している両方のサイトを一定期間保持する場合は、URL を変更できる場合があります。</li>|

## 特定のファーム ソリューションのベスト プラクティス
<a name="sectionSection2"> </a>

特定のソリューションを変換するときには、次のベスト プラクティスを適用します。


- ページ レイアウトとマスター ページ。カスタム ページ レイアウトとマスター ページは、公開サイト、または公開機能が有効になっているチーム サイトに存在している場合があります。ページ レイアウトとマスター ページを置換するには、次のようにします。
    
  1. 新しいページ レイアウトまたはマスター ページをサイトにアップロードします。手動でまたはリモート API を使用して、新しいマスター ページとページ レイアウトをサイト コレクションにアップロードします。リモート API には、クライアント側オブジェクト モデル (CSOM) または REST が含まれます。これにより、マスター ページとページ レイアウトは、ファーム ソリューションへの依存関係を持たないことになります。 
    
  2. 新しいページ レイアウトとマスター ページを使用するようにサイトを構成します。
    
  3. 以前のバージョンのページ レイアウトとマスター ページは取り消します。
    
- Web パーツとコントロール。Web パーツとコントロールを置換するには、次のようにします。
    
  1. 既存のすべてのページをスキャンして、Web パーツがあるページを特定します。
    
  2. (省略可能) 新しい Web パーツを確認して、そのいずれかでカスタム Web パーツを置き換えることができるかどうか判別します。
    
  3. 既存の Web パーツをアプリ パーツ インスタンスで置き換えるか、または他の方法 (ページまたはページ レイアウト内の埋め込み JavaScript など) を用いて同じ機能を実現します。

  4. UI 要素を操作するには、埋め込み JavaScript を使用します。
    
    
            **メモ** 既存の Web パーツをアプリ パーツに置き換えるには、次の作業が必要になります。

    - Office 365 サブスクリプションでアドインのサイド ローディングを有効にします。 Office 365 管理者に問い合わせてください。
    - CSOM を使用して、サイトでアドインのサイド ローディングを有効にします。詳細については、Core.SideLoading のコード サンプルを参照してください。
    - サイトにアプリ パーツをインストールします。
    - サイトでアドインのサイド ローディングを無効にします。
    - Office 365 サブスクリプションでアドインのサイド ローディングを無効にします。 Office 365 管理者に問い合わせてください。
<p></p>
                
- ページ操作 カスタム サイト プロビジョニングの処理中に、ページ操作の実装が必要になる場合があります。 [Provisioning.Pages](https://github.com/OfficeDev/PnP/tree/master/Samples/Provisioning.Pages) コード サンプルは、ページ操作の方法を示しています。これには Wiki ページの作成、ページへの HTML コンテンツの追加、注目リンク リストの作成、さまざまなレイアウトを持つページの作成、ページへの新規 Web パーツの追加、およびページの削除などが含まれます。
    
- サイト列、リスト定義、およびコンテンツ タイプ。サイト列、リスト定義、およびコンテンツ タイプが、ファーム ソリューションを用いて展開された機能フレームワーク要素を使用して作成されている場合は、スウィングまたはコンテンツ移行の変換方法を使う必要があります。これは、サンドボックス ソリューションを使って展開された機能フレームワーク要素には適用されません。コンテンツ移行の変換方法を使用するには、ファーム ソリューションの依存関係を削除するために、サード パーティ製のツールを使う必要があります。
    
- モジュールまたは機能フレームワーク。モジュールは、ファイルへのポインターを使用します。つまり、ファイルはカスタマイズされずに、ファイル システムに配置されるということです。ファーム ソリューションがモジュールを使用している場合は、コンテンツ データベースに同じファイルの別のバージョンを配置してファイルをカスタマイズし、ソリューションをスキャンしてコンテンツ データベースに格納されている新しいファイルをポイントするように更新し、ファイル システムに格納されているファイルをポイントしているファーム ソリューションを取り消します。
    
- サイト テンプレートと Web テンプレート。サイト テンプレートまたは Web テンプレートによって配置される機能フレームワーク要素の変換は、注意深く行う必要があります。たとえば、ファーム ソリューションを取り消す場合には、サイトの default.aspx ページが置き換えられていないことを確認します。
    
- タイマー ジョブ。SharePoint Online を使用している場合は、タイマー ジョブを作成したり管理したりすることはできません。代わりに、Windows タスク スケジューラーまたは [Azure Web ジョブ](http://azure.microsoft.com/documentation/articles/web-sites-create-web-jobs/)を使用するコンソール アプリケーションを作成して、リモートでコンソール アプリケーションをスケジュールして実行できます。カスタム タイマー ジョブを作成するときは、特定のアカウントや OAuth ベースのアプリ専用トークンを使用する必要があるかどうかを判別します。[Core.TimerJobs.Samples](https://github.com/OfficeDev/PnP/tree/master/Solutions/Core.TimerJobs.Samples) コード サンプルは、独自のカスタム タイマー ジョブを作成する方法を示しています。
    
    
            **メモ** タイマー ジョブがサーバー側のコードを使用する場合は、CSOM または別のメソッドを使用するようにタイマー ジョブを再設計する必要があります。

|**記事**|**以下の方法を説明します**|
|:-----|:-----|
|[コンテンツ タイプとサイト列の置換](replace-sharepoint-content-types-and-site-columns.md)|CSOM を使用して、SharePoint コンテンツ タイプとサイト列を置換し、新しいコンテンツ タイプにサイト列を追加して、コンテンツ タイプを新しいコンテンツ タイプと置換します。|
|[ファーム ソリューションのモジュールを使用して展開されたファイルの置換](replace-files-deployed-using-modules-in-sharepoint-farm-solutions.md)|ファーム ソリューションに含まれるモジュールを使用して展開された、SharePoint のマスター ページやページ レイアウトなどのファイルを置換します。そのためには、新しいファイルをアップロードし、それらのファイルを使用して参照を更新します。|
|[リスト定義に基づいて作成されたリストの置換](replace-sharepoint-lists-created-from-list-definitions.md)|SharePoint のリスト定義を使用して作成されたリストとライブラリを置換します。|
|[Web パーツをアドイン パーツに置換する](replace-sharepoint-web-parts-with-add-in-parts.md)|変換プロセスを使用し、SharePoint クライアント オブジェクト モデル (CSOM) を使用して、Web パーツをアドイン パーツに置換します。|

## その他のリソース
<a name="bk_addresources"> </a>

-  [Office 365 開発パターンとプラクティス (ソリューション ガイダンス)](Office-365-development-patterns-and-practices-solution-guidance.md)
    
-  [SharePoint 用アドインのビルド](https://msdn.microsoft.com/library/jj163230.aspx)
