# サンドボックス ソリューションの変換ガイダンス 
コードベースのサンドボックス ソリューションを SharePoint アドイン モデルに変換します。 既存のコードベースの機能を SharePoint アドイン モデルや代替ソリューションに変換する際のオプションと戦略について説明します。

_**適用対象:** SharePoint 用アドイン | SharePoint 2013 | SharePoint Online_

コードベースのサンドボックス ソリューションは、2014 年以降[非推奨になっています](https://blogs.msdn.microsoft.com/sharepointdev/2014/01/14/deprecation-of-custom-code-in-sandboxed-solutions/)。また、SharePoint Online では、この機能を完全に削除するためのプロセスが始まっています。 コードベースのサンドボックス ソリューションは、SharePoint 2013 および SharePoint 2016 でも非推奨になっています。

サンドボックス ソリューションの SharePoint アドイン モデルへの変換には、既存の拡張機能の分析、新しい SharePoint 用アドインの設計と開発、および運用環境でのアドインのテストと展開が含まれます。 

## SharePoint におけるコードベースのサンドボックス ソリューションとは

                <a name="sectionSection0"> </a> サンドボックス ソリューションとは、サイト コレクション レベルで SharePoint にカスタマイズを展開するために使用できる、カスタマイズ パッケージのことです。 サンドボックス ソリューションにコードが含まれている場合、そのコードは、SharePoint のサービスとコンテンツにアクセスする API の限定されたセットを使用して、特別に分離されたプロセスで実行されます。

サンドボックス ソリューションには、2 つの種類あります
- コードベースのサンドボックス ソリューション (パッケージ内にカスタム アセンブリが含まれているもの)
- 宣言的なサンドボックス ソリューション (xml ベースの構成と関連アセットのみが含まれているもの) 

宣言的な (xml ベースの) サンドボックス ソリューションは、ユース ケースに応じて、次に示す種類にさらに分割できます。
- サイト テンプレート: 「テンプレートとしてサイトを保存」機能を使用して既存のサイトから生成します
- デザイン パッケージ: デザイン マネージャーを使用して、発行サイトから生成します
- カスタム サンドボックス ソリューション: アセットのブランド化などを目的として、Visual Studio で作成します (アセンブリは含まれていません)

コードベースのサンドボックス ソリューションは、ユース ケースに応じて、次に示す種類にさらに分割できます。 
- 空のアセンブリを含む宣言型サンドボックス ソリューション
- コード使用した InfoPath フォームを含むサンドボックス ソリューション 
- Web パーツ、イベント レシーバーやフィーチャー レシーバーなどのカスタマイズを含むコードベースのサンドボックス ソリューション
- カスタム ワークフロー アクションを含むサンドボックス ソリューション

サンドボックス ソリューションからの脱却を計画している場合は、特定のソリューションの機能要件とビジネス要件を評価して、その評価に基づいた設計方針を決定する必要があります。 


## 変換を実行するための手順
<a name="sectionSection1"> </a>

サンドボックス ソリューションを SharePoint アドイン モデルに変換する場合は、ユーザーへの影響が最小限に抑えられるようにします。 現在のサンドボックス ソリューションを慎重に分析し、組織のニーズを満たすように新しい SharePoint 用アドインを設計します。 次に示すプロセスで、変換が成功したことを確認するようお勧めします。


1. 準備。 以下について調べます。
    
    - SharePoint アドイン モデル、さまざまな種類のアドイン、およびホストのオプション。 詳細については、「[SharePoint アドインの概要](https://msdn.microsoft.com/library/office/fp179930.aspx)」および「[SharePoint パーターンとプラクティス ガイダンス](https://msdn.microsoft.com/en-us/pnp_articles/office-365-development-patterns-and-practices-solution-guidance)」を参照してください。

2. ソリューションの評価。 以下のようにして、機能要件とビジネス要件を分析します。 
    
    - 現在の環境に展開済みのサンドボックス ソリューションを特定します。 
    
    - PnP 構想が提供する[詳細なサンドボックス ソリューション インベントリ スクリプト](https://github.com/OfficeDev/PnP-Tools/tree/master/Scripts/SharePoint.Sandbox.ListSolutionsFromTenant)を使用すると、テナント内にインストールされたサンドボックス ソリューションの一覧を取得できます。 このスクリプトは、サンドボックス ソリューションにアセンブリが含まれているかどうかについても示します。
    
    - ユーザーとともに要件を確認します。 日常業務を実行するために、既存のサンドボックス ソリューションをどのように使用しているかについて、ユーザーに示してもらうことを検討します。
    
    - 新しい SharePoint 用アドインに組み込む新機能を、特定、文書化、および設計します。その他のアイデアについて、ユーザーからの新機能要望リストを確認することを検討します。
    
    - 未使用の機能を特定し、その機能を新しい SharePoint 用アドインから省略することでユーザーと合意します。 
    
    - それぞれのソリューションについて、そのソリューションを SharePoint 用アドインに置き換えるのか、標準装備の機能または代替のソリューションを使用して実装するのかを判断します。
    
3.  ソリューションの計画。 以下に基づいて、SharePoint アドイン モデルを使用して新しいアプリケーションを設計します。
    
    - 手順 2 で収集した要件。
    
    - 既存コードの分析。コード分析の実行中に、削除可能なコード部分を特定することを検討します (コードが使用されなくなった、または要件が変更されたなど)。
    
4. アプリケーションの SharePoint アドイン モデル バージョンの開発とテスト。 
    
5. 新しいアドインの展開。 

## サンドボックス ソリューションのカスタマイズを置き換える
<a name="sectionSection2"> </a>

ここでは、サンドボックス ソリューションに含まれているカスタマイズと、有効な変換オプションについて説明します。 それぞれのカスタマイズの種類について詳細な情報を調べることで、変換オプションの実例が得られるようにしています。 

|**カスタマイズ**|**変換オプション**|
|:-----|:-----|
|空のアセンブリを含む宣言型のソリューション|Visual Studio のソリューション プロジェクトのプロパティで、アセンブリの作成を制御できます。 サポート技術情報の記事「[Visual Studio で作成したサンドボックス ソリューションからアセンブリ参照を削除する](https://support.microsoft.com/en-us/kb/3183084)」を参照してください。|
|コードを使用した InfoPath フォーム|<p>InfoPath クライアントからコードが含まれている InfoPath フォームを発行している場合、そのフォームは実際にはサンドボックス ソリューションとして SharePoint に発行されます。 つまり、フォームのコードは実際には SharePoint のサンドボックスのエンジンによって実行されるということです。</p> <p>コードベースの InfoPath フォームから脱却する方法は、実際のビジネスでのユース ケースによって異なります。 アドインとしてカスタム UI を生成することから別のフォーム技法を使用することまで、複数の異なるオプションがあります。</p><p>オプションの詳細については、「[InfoPath 変換ガイダンス](Sandbox-Solution-Transformation-Guidance-InfoPath.md)」を参照してください。</p>|
|Web パーツ|<p>通常、Web パーツは、アドイン パーツに変換するか、いわゆる JavaScript 埋め込みパターンを使用して、完全にクライアント側のテクノロジで実装します。 </p><p>詳細については、次に示すリソースを参照してください。<lu><li>[JavaScript を使用して SharePoint サイト UI をカスタマイズする](https://msdn.microsoft.com/en-us/pnp_articles/customize-your-sharepoint-site-ui-by-using-javascript)</li><li>[アドイン パーツを作成して SharePoint アドインと共にインストールする](https://msdn.microsoft.com/en-us/library/office/fp179921.aspx)</li><li>[JavaScript の埋め込みを使用して SharePoint ページを更新する方法](https://channel9.msdn.com/blogs/OfficeDevPnP/JavaScript-embedding-demo)</li><li>[クロスサイト コレクション ナビゲーション](https://channel9.msdn.com/blogs/OfficeDevPnP/Cross-site-collection-navigation)</li></lu></p>|
|視覚的 Web パーツ|<p>視覚的 Web パーツは、通常の Web パーツと同様の方法で変換します。 視覚的 Web パーツで使用されるユーザー コントロールも置き換える必要があります。これは、サンドボックス ソリューションでは、ユーザー コントロールがアセンブリの内部に含まれるためです。</p>|
|イベント レシーバー|<p>多くの場合、イベント レシーバーはリモート イベント レシーバーの実装に置き換えることができます。 ただし、リモート イベント レシーバーは、なんらかのプラットホームでホストされる必要があります (一般に、特定のプロバイダー ホスト型アドインに当てはまります)。</p><p>詳細については、次に示すリソースを参照してください。<lu><li>[SharePoint でリモート イベント レシーバーを使用する](https://msdn.microsoft.com/en-us/pnp_articles/use-remote-event-receivers-in-sharepoint)</li><li>[SharePoint アドインにリモート イベント レシーバーを使用する方法](https://channel9.msdn.com/blogs/OfficeDevPnP/How-to-use-remote-event-receivers-for-your-SharePoint-add-ins)</li></lu></p>|
|フィーチャー レシーバー|<p>必要とされるカスタマイズや構成をサイト レベルに適用するために CSOM または REST を使用するように、通常はリモート API ベースの操作に置き換えます。 必要な API がリモート API (CSOM/REST) にない場合は、[SharePoint UserVoice](https://sharepoint.uservoice.com/) を使用して、このギャップについて報告してください。</p><p>フィーチャー レシーバーは、たとえば、アクティブ化されたときに、カスタムのマスター ページまたはテーマをサイトに設定するために使用されることがあります。 このような操作は、簡単にリモート コード ベースのソリューションに置き換えることができます。また、サイトの構成を制御するための簡単なコマンドを提供する、[PnP PowerShell](https://github.com/OfficeDev/PnP-PowerShell/blob/master/README.md) を使用して置き換えることもできます。</p>|
|カスタム ワークフロー アクション|<p>この種のカスタマイズの一般的なコードの移行パスは、SharePoint 2013 のワークフローを使用することで開始するか、Microsoft Flow などの代替ソリューションやサード パーティ製ソリューションを使用することで進めます。</p>|

当社では、特定の技術のシナリオに向けた変換技法について、より多くの具体的な記事を求めています。 

## サイトからサンドボックス コードを削除する

                <a name="sectionSection3"> </a> 既存のサンドボックス ソリューションをサイトから非アクティブにしても、宣言オプションを使用して展開されたアセットやファイルはいずれも削除されません。 サンドボックス ソリューションを使用して新しいコード ベースの Web パーツを導入した場合、該当する機能はサイトから無効にされます。 つまり、ページは通常どおりに表示されます。そのため、ソリューションが非アクティブにされても、Web パーツのようなコード ベースの機能を削除しなければ、エンド ユーザーに直接的な影響はありません。

## その他のリソース
<a name="bk_addresources"> </a>

-  [SharePoint Online でコード ベースのサンドボックス ソリューションを削除する](http://dev.office.com/blogs/removing-code-based-sandbox-solutions-in-sharepoint-online)

-  [Visual Studio で作成したサンドボックス ソリューションからアセンブリ参照を削除する](https://support.microsoft.com/en-us/kb/3183084)

-  [Office 365 開発パターンとプラクティス (ソリューション ガイダンス)](Office-365-development-patterns-and-practices-solution-guidance.md)
    
-  [SharePoint 用アドインのビルド](https://msdn.microsoft.com/library/jj163230.aspx)
