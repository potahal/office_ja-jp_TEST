
# Excel 使用的 OLE DB for OLAP 属性

Microsoft Excel 使用的 OLE DB 进行 OLAP (联机分析处理) 提供程序连接到 OLAP 多维数据集。连接到 OLAP 多维数据集时，Excel 将读取并为 OLAP 属性设置不同的 OLE DB 和 OLE DB。Excel 将连接属性、 数据源信息属性、 架构行集的查询和单元格属性。

而不是地址所有的现有属性，本主题着重有与 Excel 的独特关系的属性。在 Excel 中的 OLAP 连接用于数据透视表和 OLAP 公式。 当测试现有的 OLAP 提供程序时，建议您有 Excel 中读取一组提供程序的属性来确定 OLAP 提供程序是否支持 OLAP 数据透视表设计和功能所需的功能。如果提供程序不支持某些功能，取决于这些功能的功能被禁用，或有限的。设置其他属性以获得所需的行为，并为 OLAP 提供程序不实现这些属性，如果 Excel 可能不使用它。

## 连接属性



|**属性集**|**属性**|**在以下情况下设置**|**设置为**|
|:-----|:-----|:-----|:-----|
|DBPROPSET_MSOLAPINIT|DBPROP_MSMD_SAFETY_OPTIONS|支持|OLAPUDFSecurity 注册表项或 DBPROPVAL_MSMD_SAFETY_OPTIONS_ALLOW_SAFE另请参见:[安全选项属性](http://msdn.microsoft.com/en-us/library/aa237323.aspx)。|
|DBPROPSET_MSOLAPINIT|DBPROP_MSMD_MDXCOMPATIBILITY|支持|DBPROP_MSMD_MDXCOMPATIBILITY_70另请参见: [MDX 的兼容性属性](http://msdn.microsoft.com/en-us/library/aa256070.aspx)。|
|DBPROPSET_MSOLAPINIT|DBPROP_MSMD_SOURCE_DSN_SUFFIX|DBPROPSET_MSOLAPINIT 中的 DBPROP_MSMD_SOURCE_DSN 出现|字符串"提示 = CompleteRequired;窗口句柄 = 0 x < hwnd >"另请参见: [Source_DSN_Suffix 属性](http://msdn.microsoft.com/en-us/library/aa237431.aspx)。|
|DBPROPSET_MSOLAPINIT|DBPROP_MSMD_MDX_MISSING_MEMBER_MODE|支持|如果该属性受支持，则 Excel 会将它设置为字符串"Error"。如果该属性不受支持，则忽略它。|
|DBPROPSET_DBINIT|[DBPROP_INIT_LCID](http://msdn.microsoft.com/en-us/library/ms719750.aspx)|支持|在建立连接之前设置。也可以指定在连接时使用任何 LCID。如果连接打开翻译，Excel 将其设置 UI 语言 (默认值)。如果属性不受支持，Excel 已没问题，而不会丢失的无根据的 UI 语言的翻译功能。|
|DBPROPSET_DBINIT|[DBPROP_INIT_PROMPT](http://msdn.microsoft.com/en-us/library/ms714342.aspx)|支持|不是 OLAP 特定。在建立连接之前设置。如果将此值设置属性失败，因为某个值不受支持，Excel 将忽略失败。|
|DBPROPSET_DBINIT|[DBPROP_AUTH_PERSIST_SENSITIVE_AUTHINFO](http://msdn.microsoft.com/en-us/library/ms714905.aspx)|支持|不是 OLAP 特定。在建立连接之前设置。Excel 似乎始终将此值设置为 True。|
|DBPROPSET_DBINIT|[DBPROP_INIT_HWND](http://msdn.microsoft.com/en-us/library/ms715949.aspx)|支持|不是 OLAP 特定。在建立连接之前设置。Excel 将其设置应用程序的主窗口以便提供程序显示使用相应的父窗口的通知。|
|DBPROPSET_DBINIT|[DBPROP_INIT_ASYNCH](http://msdn.microsoft.com/en-us/library/ms711533.aspx)|支持|不是 OLAP 特定。在建立连接之前设置。Excel 将此属性设置为 DBPROPVAL_ASYNCH_INITIALIZE 基于注册表设置 (您还可以禁用它通过使用注册表设置)。如果属性不受支持，Excel 将忽略它并不设置。|
|DBPROPSET_DBINIT|DBPROP_CMD_PROMPT|支持|不是 OLAP 特定。在建立连接之前设置。|
|DBPROPSET_DBINIT|DBPROP_CMD_HWND|支持|不是 OLAP 特定。在建立连接之前设置。|

## 数据源信息



|**属性集**|**属性**|**值**|**使用**|
|:-----|:-----|:-----|:-----|
|DBPROPSET_MDX_EXTENSIONS|DBPROP_MSMD_MDX_DDL_EXTENSIONS|如果为 DBPROPVAL_MDX_DLL_CREATESESSIONCUBE 设置了位。|如果  `CREATE SESSION CUBE` 受支持，则启用 OLAP 数据透视表的分组功能。|
|DBPROPSET_MDX_EXTENSIONS|DBPROP_MSMD_MDX_DDL_EXTENSIONS|如果为 DBPROPVAL_MDX_DDL_REFRESHCUBE 设置了位。|如果  `REFRESH CUBE` 命令受支持，则 Excel 会在 OLAP 数据透视表进行刷新时执行该命令。|
|DBPROPSET_MDX_EXTENSIONS|DBPROP_MSMD_MDX_CALCMEMB_EXTENSIONS|如果为 DBPROPVAL_MDX_CALCMEMB_ADD 设置了位。|如果  `ADDCALCULATEDMEMBERS` 在 MDX（多维表达式）中受支持，则启用 OLAP 数据透视表中的"显示计算成员"功能。|
|DBPROPSET_DATASOURCEINFO|[MDPROP_MDX_FORMULAS](http://msdn.microsoft.com/en-us/library/ms709719.aspx)|如果为 MDPROPVAL_MF_SCOPE_SESSION 和 MDPROPVAL_MF_CREATE_CALCMEMBERS 均设置了位。|如果提供程序支持创建会话成员 ( `CREATE SESSION MEMBER`)，则 Excel 会在 OLAP 数据透视表中启用此功能（仅在 Excel 中的对象模型中可用）。|
|DBPROPSET_SESSION|DBPROP_VISUALMODE|如果受支持（并且不支持子选，请参阅下面的 MDPROP_MDX_SUBQUERIES）。|启用"在汇总中包含隐藏项"控件（切换可视总计）。|
|DBPROPSET_DATASOURCEINFO|MDPROP_MDX_SUBQUERIES|如果设置两个最低位（之后，Excel 不支持非可视总计，请参阅上面的 DBPROP_VISUALMODE）。|使标签、 日期和 Excel 数据透视表中筛选的值。通常情况下使用 Excel MDX 查询构造。请注意，SQL 服务器 2005 Service Pack 2 中引入了此属性。值始终是在 msolap90.dll 的 `VARIANT_TRUE` 。|
|DBPROPSET_DATASOURCEINFO|MDPROP_MDX_DRILL_FUNCTIONS||如果设置了此属性的两个最低位，Excel 会将它解释为支持基于元组的钻孔的 `DrillDownLevel`和 `DrillDownMember`函数使用的服务器。但是，Excel 只允许钻取如果 `MDPROP_MDX_SUBQUERIES`的最小的两位也都设置 (嵌套 select 语句支持) 的特性。|
|DBPROPSET_DATASOURCEINFO|[MDPROP_FLATTENING_SUPPORT](http://msdn.microsoft.com/en-us/library/ms720900.aspx)|检查它是否设置为 MDPROPVAL_FS_FULL_SUPPORT。|由 Excel 读取，如果它未设置为  `MDPROPVAL_FS_FULL_SUPPORT`，则会发生错误，原因是 Excel 不将它视为 OLAP 提供程序。|
|DBPROPSET_DATASOURCEINFO|[MDPROP_NAMED_LEVELS](http://msdn.microsoft.com/en-gb/library/ms713691.aspx)|Excel 检查是否已设置最低位 (MDPROPVAL_NL_NAMEDLEVELS)。|如果未设置此属性的最低位，则 Excel 会失败。|
|DBPROPSET_DATASOURCEINFO|[MDPROP_MDX_SET_FUNCTIONS](http://msdn.microsoft.com/en-us/library/ms711600.aspx)||Excel 查询此属性，但没有等同于功能的效果。|
|DBPROPSET_DATASOURCEINFO|[DBPROP_DBMSVER](http://msdn.microsoft.com/en-us/library/ms719676.aspx)|Excel 检查此值是否是字符串。|Excel 不会检查此属性的实际值，而只会验证它是否是字符串。如果它不是字符串，则 Excel 无法进行连接。|
|DBPROPSET_DATASOURCEINFO|[DBPROP_DATASOURCE_TYPE](http://msdn.microsoft.com/en-us/library/ms722595.aspx)|Excel 检查是否已设置第二个最低位 (DBPROPVAL_DST_MDP)。|如果设置了该最低位，则将提供程序视为多维 (OLAP) 提供程序。|
|DBPROPSET_ROWSET|[DBPROP_ROWSET_ASYNCH](http://msdn.microsoft.com/en-us/library/ms717927.aspx)|如果受支持。|Excel 会将其设置为 `DBPROPVAL_ASYNCH_INITIALIZE` ，但如果此操作失败，Excel 回退到同步模式。如果支持，它将使 Excel 支持用户按 **Esc**键以完成之前停止执行查询。|

## 架构行集查询



|**架构行集**|**列**|**值**|**控件**|
|:-----|:-----|:-----|:-----|
|[MDSCHEMA_CUBES](http://msdn.microsoft.com/en-us/library/aa179343.aspx)|IS_DRILLTHROUGH_ENABLED|TRUE|如果设置为 TRUE，则针对 OLAP 数据透视表值区域中的单元格启用钻取（显示详细信息）功能。|
|[MDSCHEMA_HIERARCHIES](http://msdn.microsoft.com/en-us/library/aa179350.aspx)|STRUCTURE|MD_STRUCTURE_UNBALANCED|Excel 在筛选不平衡的层次结构时采用特殊的处理方法，因此，对这些元素进行此类标记以便进行控制。|
|[MDSCHEMA_HIERARCHIES](http://msdn.microsoft.com/en-us/library/ms126062.aspx)|HIERARCHY_ORIGIN|已设置 MD_ORIGIN_ATTRIBUTE 而未设置 MD_ORIGIN_USER_DEFINED|Excel 对 OLAP 数据透视表中的属性层次结构采用特殊处理方法，因此对属性层次结构进行此类标记。|
|[MDSCHEMA_HIERARCHIES](http://msdn.microsoft.com/en-us/library/ms126062.aspx)|HIERARCHY_DISPLAY_FOLDER||基于此属性，数据透视表字段列表将根据层次结构的维度在文件夹中显示层次结构。|
|[MDSCHEMA_MEASUREGROUPS](http://msdn.microsoft.com/en-us/library/ms126178.aspx)|MEASUREGROUP_NAME||表示数据透视表字段列表中的度量值组文件夹中列出了 **措施** 。|
|[MDSCHEMA_MEASUREGROUPS](http://msdn.microsoft.com/en-us/library/ms126178.aspx)|MEASUREGROUP_CAPTION||**度量值** 是表示此标题在数据透视表字段列表中的度量值组文件夹中列出。|
|[MDSCHEMA_SETS](http://msdn.microsoft.com/en-us/library/ms126290.aspx)|SET_DISPLAY_FOLDER||Excel 读取显示文件夹属性，启用该属性来将集放置在数据透视表字段列表中的显示文件夹中。|
|[MDSCHEMA_SETS](http://msdn.microsoft.com/en-us/library/ms126290.aspx)|SET_CAPTION||Excel 读取要显示在数据透视表和数据透视表字段列表中的集标题。|
|[MDSCHEMA_KPIS](http://msdn.microsoft.com/en-us/library/ms126258.aspx)|KPI_DISPLAY_FOLDER||在数据透视表字段列表中，列出了在服务器上定义 Kpi (关键绩效指标) 和组件 (值、 目标、 状态和趋势) 可以将添加到值区域。Excel 将读取此属性将 KPI 放在数据透视表字段列表中正确的显示文件夹。|
|[MDSCHEMA_KPIS](http://msdn.microsoft.com/en-us/library/ms126258.aspx)|KPI_PARENT_KPI_NAME||Excel 读取此属性以将子 KPI 放置在数据透视表字段列表中其父 KPI 下的子文件夹中（如果定义了显示文件夹，则改用显示文件夹）。|
|[MDSCHEMA_KPIS](http://msdn.microsoft.com/en-us/library/ms126258.aspx)|KPI_TREND_GRAPHIC||Excel 读取此属性，并在将趋势添加到数据透视表中时根据值将此属性映射到在 Excel 中设置的最接近的条件格式图标。|
|[MDSCHEMA_KPIS](http://msdn.microsoft.com/en-us/library/ms126258.aspx)|KPI_STATUS_GRAPHIC||Excel 读取此属性，并在将状态添加到数据透视表中时根据值将此属性映射到在 Excel 中设置的最接近的条件格式图标。|
|[MDSCHEMA_ACTIONS](http://msdn.microsoft.com/en-us/library/ms126032.aspx)|||附加操作功能。当服务器上存在适用于所选上下文的操作时，Excel 将服务器定义的操作显示在 OLAP 数据透视表的快捷菜单中。|
|[MDSCHEMA_MEASURES](http://msdn.microsoft.com/en-us/library/ms126250.aspx)|MEASURE_DISPLAY_FOLDER||由 Excel 读取，以便它可以将度量值放置在数据透视表字段列表中的正确显示文件夹中。|
|[MDSCHEMA_MEASURES](http://msdn.microsoft.com/en-us/library/ms126250.aspx)|EXPRESSION||由 Excel 读取以确定是否计算度量值。如果它是字符串并且不为空，则 Excel 会将它视为计算出的度量值。|
|[MDSCHEMA_PROPERTIES](http://msdn.microsoft.com/en-us/library/ms126309.aspx)|PROPERTY_NAME|"MEMBER_VALUE"这也可以用来获取常规成员属性的架构。"MEMBER_VALUE"值是一种特殊情况，但有其他用途。|Excel 获取成员值的维度中的属性的属性限制为"MEMBER_VALUE"PROPERTY_NAME 列中。数据类型 (DATA_TYPE) 的 MEMBER_VALUE 属性的时间维度的键属性是 **日期** ，如果数据透视表将公开日期而不标签过滤筛选。 实际日期筛选是密钥的根据成员的 value 属性独立的筛选该维度的层次结构。
 **注释**  日期筛选要求支持子选（请参阅上面的 MDPROP_MDX_SUBQUERIES）。

|
|MDSCHEMA_DISCOVER|RESTRICTIONS||根据具体使用情况，Excel 将限制在层次结构、 级别或度量值读取 MDSCHEMA_DISCOVER 行集合获取限制时。Excel 中读取架构按行并查找列表中的所有其他相关架构获得的限制会影响 Excel 索引限制。限制列中包含 Excel 在名称列从中查找另一个行集的句柄的一章。在名称列中，Excel 希望找到的字符串 HIERARCHY_VISIBILITY，MEASURE_VISIBILITY，LEVEL_VISIBILITY (如果提供程序支持限制上可见性)。如果 Excel 找不到 < xxx > 可见字符串 (或不支持 MDSCHEMA_DISCOVER) 将假设，提供程序不支持返回隐藏的项目，它将不会查询它们。|
|[MDSCHEMA_LEVELS](http://msdn.microsoft.com/en-us/library/ms126038.aspx)|LEVEL_ATTRIBUTE_HIERARCHY_NAME||供 Excel 用于隐藏含系统生成的名称的特殊分组级别。请注意，使用 Microsoft SQL Server 2005 Analysis Services Service Pack 2 时不需要此函数。|
|[MDSCHEMA_LEVELS](http://msdn.microsoft.com/en-us/library/ms126038.aspx)|CUSTOM_ROLLUP_SETTINGS|0|如果不为 0，则 Excel 假设该级别具有自定义汇总。Excel 会对每个层次结构的所有级别检查此，如果存在自定义汇总，则禁用一些操作（例如分组）。|

## 单元格属性



|**属性名称**|**使用**|
|:-----|:-----|
|**语言**|用于确定如何解释 `FORMAT_STRING` **货币** 时的 LCID。Excel 将使用此属性来确定与 `FORMAT_STRING`设置为 **货币** 格式值时要使用的货币符号。[检索单元格属性](http://msdn.microsoft.com/en-us/library/ms715853.aspx)指定客户端应用程序要领取的语言属性的计算度量值定义的示例:


```
CREATE MEMBER CURRENTCUBE.[Measures].[Internet Gross Profit] 
 AS 
[Measures].[Internet Sales Amount]  
-  
[Measures].[Internet Total Product Cost], 
 
FORMAT_STRING = "Currency", 
BACK_COLOR = 12615680 /*R=0, G=128, B=192*/, 
FORE_COLOR = 65408 /*R=128, G=255, B=0*/, 
FONT_FLAGS = 3 /*Bold, Italic*/, 
NON_EMPTY_BEHAVIOR = { [Internet Sales Amount],[Internet Total Product Cost] }, 
VISIBLE = 1, 
LANGUAGE = 1033 /*Telling client application to display US currency symbol*/;
```

|


