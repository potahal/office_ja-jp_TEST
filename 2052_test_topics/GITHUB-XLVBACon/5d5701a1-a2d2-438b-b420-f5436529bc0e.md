
# 禁止使用重复值的区域中

下面的代码示例验证区域 a1: b20 中输入的值在该范围内任何当前工作簿中的工作表上存在是否存在值可防止重复项。

 **示例提供的代码:** 神圣的宏!书中，[神圣宏!它是 2500 Excel VBA 示例](http://www.mrexcel.com/store/index.php?l=product_detail&amp;p=1)



```
Private Sub Workbook_SheetChange(ByVal Sh As Object, ByVal Target As Range)

    'Define your variables.
    Dim ws As Worksheet, EvalRange As Range
    
    'Set the range where you want to prevent duplicate entries.
    Set EvalRange = Range("A1:B20")
    
    'If the cell where value was entered is not in the defined range, if the value pasted is larger than a single cell,
    'or if no value was entered in the cell, then exit the macro.
    If Intersect(Target, EvalRange) Is Nothing Or Target.Cells.Count > 1 Then Exit Sub
    If IsEmpty(Target) Then Exit Sub
    
    'If the value entered already exists in the defined range on the current worksheet, throw an
    'error message and undo the entry.
    If WorksheetFunction.CountIf(EvalRange, Target.Value) > 1 Then
        MsgBox Target.Value &amp; " already exists on this sheet."
        Application.EnableEvents = False
        Application.Undo
        Application.EnableEvents = True
    End If
    
    'Check the other worksheets in the workbook.
    For Each ws In Worksheets
        With ws
            If .Name <> Target.Parent.Name Then
                'If the value entered already exists in the defined range on the current worksheet, throw an
                'error message and undo the entry.
                If WorksheetFunction.CountIf(Sheets(.Name).Range("A1:B20"), Target.Value) > 0 Then
                    MsgBox Target.Value &amp; " already exists on the sheet named " &amp; .Name &amp; ".", _
                    16, "No duplicates allowed in " &amp; EvalRange.Address(0, 0) &amp; "."
                    Application.EnableEvents = False
                    Application.Undo
                    Application.EnableEvents = True
                    Exit For
                End If
            End If
        End With
    Next ws

End Sub
```


## 有关参与者
<a name="AboutContributor"> </a>

Holy Macro! Books 主要出版娱乐书籍，供使用 Microsoft Office 的人员阅读。单击 MrExcel.com，查看完整的目录。

