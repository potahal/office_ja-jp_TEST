
# 使用单元格值命名工作表

本示例演示如何使用该工作表上单元格 A1 中的值来命名工作表。本示例验证单元格 A1 中的值是否为有效的工作表名称，如果它是有效的名称，则使用  **[Worksheet](182b705e-854a-81cc-a4b0-59b942de55ae.md)** 对象的 **[Name](3d000cdf-5e81-8701-ca7f-bdcce006363b.md)** 属性将活动工作表重命名为单元格 A1 的值。

 **示例代码提供者：** Tom Urtis，[Atlas Programming Management](http://www.atlaspm.com/)



```
Private Sub Worksheet_Change(ByVal Target As Range)
    'Specify the target cell whose entry shall be the sheet tab name.
    If Target.Address <> "$A$1" Then Exit Sub
        'If the target cell is empty (contents cleared) then do not change the shet name
    If IsEmpty(Target) Then Exit Sub

    'If the length of the target cell's entry is greater than 31 characters, disallow the entry.
    If Len(Target.Value) > 31 Then
        MsgBox "Worksheet tab names cannot be greater than 31 characters in length." &amp; vbCrLf &amp; _
        "You entered " &amp; Target.Value &amp; ", which has " &amp; Len(Target.Value) &amp; " characters.", , "Keep it under 31 characters"
        Application.EnableEvents = False
        Target.ClearContents
        Application.EnableEvents = True
        Exit Sub
    End If

    'Sheet tab names cannot contain the characters /, \, [, ], *, ?, or :.
    'Verify that none of these characters are present in the cell's entry.
    Dim IllegalCharacter(1 To 7) As String, i As Integer
    IllegalCharacter(1) = "/"
    IllegalCharacter(2) = "\"
    IllegalCharacter(3) = "["
    IllegalCharacter(4) = "]"
    IllegalCharacter(5) = "*"
    IllegalCharacter(6) = "?"
    IllegalCharacter(7) = ":"
    For i = 1 To 7
        If InStr(Target.Value, (IllegalCharacter(i))) > 0 Then
            MsgBox "You used a character that violates sheet naming rules." &amp; vbCrLf &amp; vbCrLf &amp; _
            "Please re-enter a sheet name without the ''" &amp; IllegalCharacter(i) &amp; "'' character.", 48, "Not a possible sheet name !!"
            Application.EnableEvents = False
            Target.ClearContents
            Application.EnableEvents = True
            Exit Sub
        End If
    Next i

    'Verify that the proposed sheet name does not already exist in the workbook.
    Dim strSheetName As String, wks As Worksheet, bln As Boolean
    strSheetName = Trim(Target.Value)
    On Error Resume Next
    Set wks = ActiveWorkbook.Worksheets(strSheetName)
    On Error Resume Next
    If Not wks Is Nothing Then
        bln = True
    Else
        bln = False
        Err.Clear
    End If

    'If the worksheet name does not already exist, name the active sheet as the target cell value.
    'Otherwise, advise the user that duplicate sheet names are not allowed.
    If bln = False Then
        ActiveSheet.Name = strSheetName
    Else
        MsgBox "There is already a sheet named " &amp; strSheetName &amp; "." &amp; vbCrLf &amp; _
        "Please enter a unique name for this sheet."
        Application.EnableEvents = False
        Target.ClearContents
        Application.EnableEvents = True
    End If

End Sub
```


## 关于参与者
<a name="AboutContributor"> </a>

MVP Tom Urtis 是 Atlas Programming Management（提供 Microsoft Office 和 Excel 业务解决方案全面服务的公司，位于硅谷）的创始人。Tom 在业务管理和开发 Microsoft Office 应用程序方面拥有超过 25 年的经验，并协助编写了"Holy Macro! It's 2,500 Excel VBA Examples" 。

